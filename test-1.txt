user_name = os.getlogin()

# Function for cookie management
def cookie_management():
    profile = 'Default'
    profile_path = f'C:\\Users\\{user_name}\\AppData\\Local\\Google\\Chrome\\User Data\\Default'
    options = Options()
    options.add_argument('--disable-dev-shm-usage')
    options.add_experimental_option('excludeSwitches', ['enable-logging'])
    options.add_argument(f'user-data-dir={profile_path}')
    options.add_argument(f'--profile-directory={profile}')
    options.add_argument('--no-sandbox')
    options.add_argument('--start-maximized')
    options.add_argument('--disable-gpu')
    options.add_experimental_option('excludeSwitches', ['enable-logging'])
    service = Service(f"C:\\Users\\{user_name}\\driver\\chromedriver.exe")
    download_path = "C:\\Users\\"+user_name+"\\Downloads"
    options.add_experimental_option("prefs", {
        "download.default_directory": download_path,
        "download.prompt_for_download": False,
        "download.directory_upgrade": True,
        "safebrowsing.enabled": True
    })
    driver = webdriver.Chrome(service=service, options=options)
    
    return driver

driver = cookie_management()


driver.get("https://prod-eu.ship-window-portal.scot.amazon.dev/")
WebDriverWait(driver, 120).until(EC.url_contains("https://prod-eu.ship-window-portal.scot.amazon.dev/"))
with open('C:/Users/'+user_name+'/Documents/Automation/ShipWindow/input_VC.csv', 'r') as read_obj, \
        open('C:/Users/'+user_name+'/Documents/Automation/ShipWindow/output_Vm_Sw.csv', 'w', newline='') as write_obj:
    csv_reader = csv.reader(read_obj) # , delimiter='\t'
    csv_writer = csv.writer(write_obj)
    
    #Heading for CSV file
    csv_writer.writerow(["Vendor Code","Vendor Organization Owner","Business Group","Status"])
    
    for a, vc in enumerate(csv_reader, start=1):
        
        override_info = []
        override_info.append(vc[0])
        
        # Vendor Master portal 1 of 2
        try:
            # Opening Web page
            driver.get("https://vops-na.corp.amazon.com/#/search/vendorCode/"+vc[0])
            
            # Waiting for Web element to load
            WebDriverWait(driver, 60).until(EC.presence_of_element_located((By.XPATH,"//div[span[text() ='Organization Owner']]/following-sibling::span")))
            
            # Getting Web elements Owner and GL
            own = driver.find_elements(By.XPATH,"//div[span[text() ='Organization Owner']]/following-sibling::span")
            gl = driver.find_elements(By.XPATH,"//div[span[text() ='Business Group']]/following-sibling::span")
            
            # Writing in CSV file.        
            override_info.append(own[0].text)
            override_info.append(gl[0].text)
            print(vc[0], a, own[0].text, gl[0].text)
            csv_writer.writerow(override_info)
            
        except:
            # not found in code
            for w in range(2):
                override_info.append("No")
            
    # End of Vendor Master portal 1 of 2
    

    read_obj.close()
    write_obj.close()
        # end of ship window 2 of 2

driver.quit()
# Open the excel file
os.startfile("C:\\Users\\"+user_name+"\\Documents\\Automation\\ShipWindow\\output_Vm_Sw.csv")

print("Thank you for running the automation")
ctypes.windll.user32.MessageBoxW(0, "Completed !!", "SUCCESS", 64)
