"Jxpravin"


import os
import time
import pandas as pd


from tqdm import tqdm

from selenium import webdriver
from selenium.webdriver import Keys
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC


user_name = os.getlogin()
startTime = time.time()

def open_chrome():
    
    service = Service("C:\\Users\\"+user_name+"\\driver\\chromedriver.exe")
    
    driver = webdriver.Chrome(service=service)
    return driver

driver = open_chrome()

inData = input("Enter the input file name with extension (e.g., PO_INPUT.xlsx): ")
df = pd.read_excel(inData)

# looping over given PO
for index, row in tqdm(df.iterrows(), total=len(df), desc="POs"):
    try:
        # to open the url in browser
        driver.get('about:blank')      
        driver.get(f'https://procurementportal-eu.corp.amazon.com/bp/po?poId={row['po']}&tabId=summary')
        WebDriverWait(driver,60, poll_frequency=1).until(EC.visibility_of_element_located((By.XPATH,"//button[normalize-space(text())='Update Actions']")))
        
        driver.find_element(By.XPATH,"//button[normalize-space(text())='Update Actions']").click()
        time.sleep(1)
        
        if len(driver.find_elements(By.XPATH, "//button[@id='bp_edit_header' and not(.//*[contains(@class, 'grey')])]")):
            
            driver.find_element(By.XPATH, "//button[@id='bp_edit_header' and not(.//*[contains(@class, 'grey')])]").click()
            time.sleep(2)
            
            e1 = driver.execute_script("return document.querySelector('#term-code-select')")
            time.sleep(0.3)
            driver.execute_script("arguments[0].value = arguments[1]; arguments[0].dispatchEvent(new Event('change'));", e1, "10022")
            time.sleep(0.5)
            
            # Click the Save button
            save_btn = driver.execute_script(
                "return document.querySelector('kat-button.confirmButton[label=\"Save\"][type=\"button\"]')"
            )
            driver.execute_script("arguments[0].scrollIntoView(true);", save_btn)
            time.sleep(1)
            save_btn.click()
            time.sleep(1)

            # Click the Yes confirmation button
            yes_btn = driver.execute_script("""
                return Array.from(document.querySelectorAll('button.btn.btn-secondary[type="button"]'))
                            .find(btn => btn.textContent.trim() === 'Yes');
            """)
            yes_btn.click()
            
            WebDriverWait(driver,20, poll_frequency=1).until(EC.visibility_of_element_located((By.CLASS_NAME,"alert-success")))
            
            df.at[index, 'Status'] = 'Term Code Updated Successfully'
            
        else:
            print(f"PO {row['po']} is not in editable state, skipping...")
            continue
            
    except Exception as e:
        print(f"Error processing PO {row['po']}: {e}")
        df.at[index, 'Status'] = "error"
        

driver.quit()        

df.to_excel(f"PO_Output_{str(round(time.time()))}.xlsx",index=False)     

endTime = time.time()

print("Operational Completed")
print("Time Taken :", round((endTime-startTime)/60, 2), 'mins')

time.sleep(10)
