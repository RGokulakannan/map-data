
"Jxpravin"


import os
import time
import pandas as pd


from tqdm import tqdm

from selenium import webdriver
from selenium.webdriver import Keys
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC


user_name = os.getlogin()
startTime = time.time()

def open_chrome():
    profile = 'Default'
    profile_path = f'C:\\Users\\{user_name}\\AppData\\Local\\Google\\Chrome\\User Data\\Default'
    options = Options()
    options.add_argument(f'user-data-dir={profile_path}')
    options.add_argument(f'--profile-directory={profile}')
    options.add_argument('--start-maximized')
    options.add_argument('--disable-dev-shm-usage')
    options.add_experimental_option('excludeSwitches', ['enable-logging'])
    options.add_argument('--no-sandbox')
    options.add_argument('--disable-gpu')
    service = Service("C:\\Users\\"+user_name+"\\driver\\chromedriver.exe")
    download_path = "C:\\Users\\"+user_name+"\\Downloads"
    options.add_experimental_option("prefs", {
        "download.default_directory": download_path,
        "download.prompt_for_download": False,
        "download.directory_upgrade": True,
        "safebrowsing.enabled": True
    })
    driver = webdriver.Chrome(service=service, options=options)
    return driver

driver = open_chrome()
df = pd.read_excel(f"PO_INPUT.xlsx")

# looping over given PO
for index, row in tqdm(df.iterrows(), total=len(df), desc="POs"):
    
        # to open the url in browser
        driver.get('about:blank')      
        driver.get(f'https://procurementportal-eu.corp.amazon.com/bp/po?poId={row['po']}&tabId=summary')
        WebDriverWait(driver,60, poll_frequency=1).until(EC.visibility_of_element_located((By.XPATH,"//button[normalize-space(text())='Update Actions']")))
        time.sleep(1)
        
        driver.find_element(By.XPATH,"//button[normalize-space(text())='Update Actions']").click()
        time.sleep(1)
        
        if len(driver.find_elements(By.XPATH, "//button[@id='bp_edit_header' and not(.//*[contains(@class, 'grey')])]")):
            
            driver.find_element(By.XPATH, "//button[@id='bp_edit_header' and not(.//*[contains(@class, 'grey')])]").click()
            time.sleep(3)
            
            e1 = driver.execute_script("return document.querySelector('#term-code-select')")
            time.sleep(0.3)
            driver.execute_script("arguments[0].value = arguments[1]; arguments[0].dispatchEvent(new Event('change'));", e1, "10022")
            time.sleep(1)
            
            # Click the Save button
            save_btn = driver.execute_script(
                "return document.querySelector('kat-button.confirmButton[label=\"Save\"][type=\"button\"]')"
            )
            driver.execute_script("arguments[0].scrollIntoView(true);", save_btn)
            time.sleep(1)
            save_btn.click()
            time.sleep(1)

            # Click the Yes confirmation button
            yes_btn = driver.execute_script("""
                return Array.from(document.querySelectorAll('button.btn.btn-secondary[type="button"]'))
                            .find(btn => btn.textContent.trim() === 'Yes');
            """)
            yes_btn.click()
            time.sleep(2)
            
            WebDriverWait(driver,20, poll_frequency=1).until(EC.visibility_of_element_located((By.CLASS_NAME,"alert-success")))
            
            
        else:
            print(f"PO {row['po']} is not in editable state, skipping...")
            continue
            


driver.quit()        

df.to_excel(f"PO_Output.xlsx",index=False)     

endTime = time.time()

print("Operational Completed")
print("Time Taken :", round((endTime-startTime)/60, 2), 'mins')

time.sleep(10)
