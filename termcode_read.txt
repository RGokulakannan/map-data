"Jxpravin"


import os
import time
import pandas as pd


from tqdm import tqdm

from selenium import webdriver
from selenium.webdriver import Keys
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC


user_name = os.getlogin()
startTime = time.time()

def open_chrome():
    profile = 'Default'
    profile_path = f'C:\\Users\\{user_name}\\AppData\\Local\\Google\\Chrome\\User Data\\Default'
    options = Options()
    options.add_argument(f'user-data-dir={profile_path}')
    options.add_argument(f'--profile-directory={profile}')
    options.add_argument('--start-maximized')
    options.add_argument('--disable-dev-shm-usage')
    options.add_experimental_option('excludeSwitches', ['enable-logging'])
    options.add_argument('--no-sandbox')
    options.add_argument('--disable-gpu')
    service = Service("C:\\Users\\"+user_name+"\\driver\\chromedriver.exe")
    download_path = "C:\\Users\\"+user_name+"\\Downloads"
    options.add_experimental_option("prefs", {
        "download.default_directory": download_path,
        "download.prompt_for_download": False,
        "download.directory_upgrade": True,
        "safebrowsing.enabled": True
    })
    driver = webdriver.Chrome(service=service, options=options)
    return driver

driver = open_chrome()
df = pd.read_excel(f"PO_INPUT.xlsx")

# looping over given PO
for index, row in tqdm(df.iterrows(), total=len(df), desc="POs"):
    try:
        # to open the url in browser
        driver.get('about:blank')      
        time.sleep(0.3)
        driver.get(f'https://procurementportal-eu.corp.amazon.com/bp/po?poId={row['po']}&tabId=summary')
        df.at[index, "Term Code"] = WebDriverWait(driver,60, poll_frequency=1).until(EC.visibility_of_element_located((By.ID, "SummaryPane_FinancialData_TermCode_Value"))).text

    except Exception as e:
        print(f"Error processing PO {row['po']}: {e}")
        df.at[index, 'Status'] = "error"
        

driver.quit()        

df.to_excel(f"PO_Output_Read.xlsx",index=False)     

endTime = time.time()

print("Operational Completed")
print("Time Taken :", round((endTime-startTime)/60, 2), 'mins')

time.sleep(10)
